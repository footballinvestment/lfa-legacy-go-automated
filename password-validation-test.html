<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Validation Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .test-container { background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .password-input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; }
        .result { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .loading { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .strength-bar { width: 100%; height: 6px; background: #e0e0e0; border-radius: 3px; margin: 8px 0; }
        .strength-fill { height: 100%; border-radius: 3px; transition: width 0.3s ease; }
    </style>
</head>
<body>
    <h1>üîê LFA Legacy GO - Password Security Test</h1>
    <p>Testing NIST 2024 compliant password validation with the live backend API.</p>

    <div class="test-container">
        <h2>üß™ Password Strength Validator</h2>
        <input type="password" id="passwordInput" class="password-input" placeholder="Enter password to test..." />
        <button onclick="testPassword()">Validate Password</button>
        <div id="result"></div>
    </div>

    <div class="test-container">
        <h2>üìã Test Cases</h2>
        <button onclick="testCase('weak')">Test: 'weak' (should fail)</button>
        <button onclick="testCase('password123')">Test: 'password123' (should fail)</button>
        <button onclick="testCase('ThisIsAVerySecurePassword2024')">Test: Strong Password (should pass)</button>
        <button onclick="testCase('MyExcellentPasswordForTesting!')">Test: Excellent Password (should pass)</button>
    </div>

    <script>
        const API_BASE = 'https://lfa-legacy-go-backend-376491487980.us-central1.run.app/api/auth';
        
        async function validatePassword(password) {
            const response = await fetch(`${API_BASE}/validate-password`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ password })
            });
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${await response.text()}`);
            }
            
            return await response.json();
        }
        
        async function testPassword() {
            const password = document.getElementById('passwordInput').value;
            const resultDiv = document.getElementById('result');
            
            if (!password) {
                resultDiv.innerHTML = '<div class="error">Please enter a password to test</div>';
                return;
            }
            
            resultDiv.innerHTML = '<div class="loading">üîÑ Validating password...</div>';
            
            try {
                const result = await validatePassword(password);
                displayResult(result, password);
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        function testCase(password) {
            document.getElementById('passwordInput').value = password;
            testPassword();
        }
        
        function displayResult(result, password) {
            const resultDiv = document.getElementById('result');
            
            const strengthColors = ['#ff4444', '#ff7744', '#ffaa44', '#44ff44', '#00aa00'];
            const strengthColor = strengthColors[result.score] || '#cccccc';
            
            let html = `
                <div class="${result.valid ? 'success' : 'error'}">
                    <h3>${result.valid ? '‚úÖ' : '‚ùå'} Password: "${password}"</h3>
                    
                    <div class="strength-bar">
                        <div class="strength-fill" style="width: ${result.score * 25}%; background-color: ${strengthColor};"></div>
                    </div>
                    
                    <p><strong>Valid:</strong> ${result.valid}</p>
                    <p><strong>Score:</strong> ${result.score}/4</p>
                    <p><strong>Strength:</strong> ${result.strength_level}</p>
                    <p><strong>Breached:</strong> ${result.is_breached}</p>
                    
                    ${result.feedback && result.feedback.length > 0 ? 
                        '<p><strong>Feedback:</strong><ul>' + 
                        result.feedback.map(f => `<li>${f}</li>`).join('') + 
                        '</ul></p>' : ''
                    }
                </div>
            `;
            
            resultDiv.innerHTML = html;
        }
        
        // Test on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üîê Password validation test page loaded');
        });
    </script>
</body>
</html>